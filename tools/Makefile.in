FC=gfortran

HOMEDIR=../../
CODE_OBJ=$(HOMEDIR)obj/

LIBS = -lhdf5 -lhdf5hl_fortran -lhdf5_hl -lhdf5_fortran -lm
INCLUDE = -I/usr/include/ -I$(CODE_OBJ)

CFLAGS = -std=f2008
CFLAGS +=-g -fbacktrace

EXECUTABLE_DIR = ../bin
SOURCE_DIR = ../src

_SCRIPT=pre_config make_dependencies

_EXE= extract_1D create_xdmf pre_config sol2vtk

EXE = $(patsubst %,$(EXECUTABLE_DIR)/%,$(_EXE))
SCRIPT = $(patsubst %,$(EXECUTABLE_DIR)/%,$(_SCRIPT))

all: $(SCRIPT) $(EXE) module_gridgen.o module_post.a

$(EXECUTABLE_DIR)/make_dependencies:
	@ln -s $(SOURCE_DIR)/make_dependencies.py $@


#$(EXECUTABLE_DIR)/pre_config:
	#@ln -s $(SOURCE_DIR)/pre_config.py $@

module_post.a:module_post.o $(CODE_OBJ)screen_io_mod.o $(CODE_OBJ)control_mod.o
	@ar r $@ $^


$(EXECUTABLE_DIR)/sol2vtk:$(SOURCE_DIR)/sol2vtk.F90 module_post.o $(CODE_OBJ)file_io_mod.o $(CODE_OBJ)const_mod.o $(CODE_OBJ)data_mod.o $(CODE_OBJ)screen_io_mod.o $(CODE_OBJ)control_mod.o
	$(FC) $(CFLAGS) $^ $(LIBS) -o $@ $(INCLUDE)

$(EXECUTABLE_DIR)/extract_1D:$(SOURCE_DIR)/extract_1D.F90 module_post.o $(CODE_OBJ)file_io_mod.o $(CODE_OBJ)const_mod.o $(CODE_OBJ)data_mod.o $(CODE_OBJ)screen_io_mod.o $(CODE_OBJ)control_mod.o
	$(FC) $(CFLAGS) $^ $(LIBS) -o $@ $(INCLUDE)


$(EXECUTABLE_DIR)/%:$(SOURCE_DIR)/%.F90
	$(FC) $(CFLAGS) $^ $(LIBS) -o $@ $(INCLUDE)

%.o: ../src/%.F90
	$(FC) $(CFLAGS) $< -c $(INCLUDE)
include ../../src/inc_Makefile_dep
