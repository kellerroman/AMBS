FC=gfortran
#FC=ifort

LIBS = -lhdf5 -lhdf5hl_fortran -lhdf5_hl -lhdf5_fortran -lm

INCLUDE = -I/usr/include/
CFLAGS = -std=f2008
CFLAGS += -Wconversion -Wall -Wextra -Warray-temporaries -Werror
#CFLAGS += -DDEBUG #Unnecessary comments are oppressed
CFLAGS += -O3
#CFLAGS += -g -fbacktrace -ffpe-trap=invalid,zero,overflow -fcheck=all -fbounds-check
EXECUTABLE = ../bin/AMBS
SOURCE_DIR = ../src

include $(SOURCE_DIR)/inc_Makefile_src
          
OBJECTS=$(_SOURCES:.F90=.o)

VPATH := $(SOURCE_DIR)

compile: $(EXECUTABLE)
	@true

$(EXECUTABLE): $(OBJECTS)
	$(FC) $(CFLAGS) $^ -o $@ $(LIBS) $(INCLUDE)

%.o: %.F90
	$(FC) -c $(CFLAGS) $(INCLUDE) $< -o $@ 
	
include $(SOURCE_DIR)/inc_Makefile_dep
	
.PHONY: clean compile

clean:
	@rm -vf $(EXECUTABLE) *.o *.mod $(SOURCE_DIR)/*~
	@rm -vrf ../*~

debug: CFLAGS += -DDEBUG 
debug: compile

dep:
	cd ../src; ../tools/bin/make_dependencies . 
