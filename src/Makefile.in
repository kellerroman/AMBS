FC=gfortran
#FC=ifort

CGNSlibs = /home/kell_ro/software/cgns/src/cgns_build/lib/libcgns.a /media/LDS/module/tools/hdf5/1.8.15_GCC-4.9.2/lib/libhdf5.a
LIBS = $(CGNSlibs) -lm -ldl -lz

INCLUDE = -I/usr/include/ -I/home/kell_ro/software/cgns/src/cgns_build/include/
CFLAGS = -std=f2008
CFLAGS += -Wconversion -Wall -Wextra -Warray-temporaries -Werror
#CFLAGS += -DDEBUG #Unnecessary comments are oppressed
CFLAGS += -O3
#CFLAGS += -g -fbacktrace -ffpe-trap=invalid,zero,overflow -fcheck=all -fbounds-check
EXECUTABLE = ../bin/AMBS
SOURCE_DIR = ../src

include $(SOURCE_DIR)/inc_Makefile_src
          
OBJECTS=$(_SOURCES:.F90=.o)

VPATH := $(SOURCE_DIR)

compile: $(EXECUTABLE)
	@true

$(EXECUTABLE): $(OBJECTS)
	$(FC) $(CFLAGS) $^ -o $@ $(LIBS) $(INCLUDE)

%.o: %.F90
	$(FC) -c $(CFLAGS) $(INCLUDE) $< -o $@ 
	
include $(SOURCE_DIR)/inc_Makefile_dep
	
.PHONY: clean compile

clean:
	@rm -vf $(EXECUTABLE) *.o *.mod $(SOURCE_DIR)/*~
	@rm -vrf ../*~

debug: CFLAGS += -DDEBUG 
debug: compile

dep:
	cd ../src; ../tools/bin/make_dependencies . 
